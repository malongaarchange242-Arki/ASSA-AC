/* ================= Variables CSS ================= */
:root {
    --primary-blue: #1A73E8;
    --dark-blue: #0B3F7B;
    --light-bg: #F5F7FA;
    --text-color: #3C4043;
    --border-color: #DADCE0;
    --sidebar-width: 250px;
    --alert-red: #D93025;
    --nav-text-default: #E0E0E0;

    /* Variables d'application standard */
    --surface-color: white; /* Header, Chat Header, Input Area, Client Bubble */
    --list-hover-bg: #F8F8F8;
    --list-active-bg: rgba(26,115,232,0.1);
    --chat-background: var(--light-bg);
    --client-bubble-border: #E0E0E0;
    --secondary-text-color: #70757A;

    /* VARIABLES DARK MODE */
    --dark-bg-main: #121212;
    --dark-surface: #1E1E1E;
    --dark-text-color: #E0E0E0;
    --dark-border-color: #333333;
    --dark-list-hover-bg: #2A2A2A;
    --dark-list-active-bg: rgba(26,115,232,0.2);
    --dark-client-bubble-bg: #282828;
    --dark-primary-blue-adjusted: #5499F4; /* Bleu l√©g√®rement √©clairci pour Dark Mode */
    --dark-secondary-text-color: #A0A0A0;
}

/* ========================================================= */
/* üåô DARK MODE STYLES (Corrig√© et Nettoy√©) */
/* ========================================================= */

body.dark-mode {
    /* Mettre √† jour les variables g√©n√©rales */
    background-color: var(--dark-bg-main);
    color: var(--dark-text-color);
    --text-color: var(--dark-text-color);
    --border-color: var(--dark-border-color);
    --surface-color: var(--dark-surface);
    --chat-background: var(--dark-bg-main);
    --secondary-text-color: var(--dark-secondary-text-color);
    
    /* Variables sp√©cifiques √† la messagerie */
    --list-hover-bg: var(--dark-list-hover-bg);
    --list-active-bg: var(--dark-list-active-bg);
    --client-bubble-border: var(--dark-border-color);
    
    /* Red√©finition de la couleur des liens de navigation */
    --nav-text-default: var(--dark-secondary-text-color);
}

/* Surcharge de la sidebar pour qu'elle soit sombre au lieu de bleu fonc√© */
body.dark-mode .sidebar {
    background-color: var(--dark-surface); /* Passage au gris sombre */
    color: var(--dark-text-color); /* Texte clair */
    box-shadow: 2px 0 5px rgba(255,255,255,0.05);
}

/* Ajustement du header de la sidebar (logo/texte) */
body.dark-mode .sidebar-header {
    color: var(--dark-text-color);
}
body.dark-mode .logo-text {
    color: var(--dark-primary-blue-adjusted);
}


/* Header, Conteneurs, Barres */
body.dark-mode .header,
body.dark-mode .conversations-list,
body.dark-mode .chat-header,
body.dark-mode .chat-input-area,
body.dark-mode .preview-container {
    background-color: var(--dark-surface);
}

/* Chat Area Background */
body.dark-mode .chat-area {
    background-color: var(--chat-background);
}

/* Texte et Titres */
body.dark-mode .list-header {
    color: var(--dark-text-color);
}
body.dark-mode .conv-company {
    color: var(--dark-text-color);
}
body.dark-mode .chat-header h2 {
    color: var(--dark-primary-blue-adjusted);
}
body.dark-mode .chat-header p {
    color: var(--dark-secondary-text-color);
}

/* Liens de navigation (Hover/Active) */
body.dark-mode .nav-menu a, 
body.dark-mode .sidebar-bottom a { 
    color: var(--nav-text-default);
}
body.dark-mode .nav-menu a:hover, 
body.dark-mode .sidebar-bottom a:hover { 
    background-color: var(--dark-list-hover-bg); 
    border-left-color: var(--dark-primary-blue-adjusted);
}
body.dark-mode .nav-menu a.active { 
    background-color: var(--dark-list-active-bg); 
    color: var(--dark-text-color);
    border-left-color: var(--dark-text-color); 
}


/* Conversation List Items */
body.dark-mode .conversation-item {
    border-bottom-color: var(--dark-border-color);
}
body.dark-mode .conversation-item:hover { 
    background-color: var(--dark-list-hover-bg); 
}
body.dark-mode .conversation-item.active { 
    background-color: var(--dark-list-active-bg); 
}

/* Input et Textarea */
body.dark-mode .search-bar input,
body.dark-mode .chat-input-area textarea {
    background-color: #2D2D2D;
    color: var(--dark-text-color);
    border-color: var(--dark-border-color);
}
body.dark-mode .search-bar input::placeholder,
body.dark-mode .chat-input-area textarea::placeholder {
    color: var(--dark-secondary-text-color);
}

/* Bulles de Message */

/* Client (droite) : Fond sombre, Texte clair */
body.dark-mode .message-client {
    background: var(--dark-client-bubble-bg);
    color: var(--dark-text-color);
    border-color: var(--dark-border-color);
}
body.dark-mode .message-client::after {
    border-left-color: var(--dark-client-bubble-bg) !important; 
}

/* Admin (gauche) : Garder le bleu, ajuster */
body.dark-mode .message-admin {
    background: var(--dark-primary-blue-adjusted);
}
body.dark-mode .message-admin::after {
    border-right-color: var(--dark-primary-blue-adjusted) !important;
}

/* Boutons d'action (restent pour les boutons d'envoi et d'attachement) */
body.dark-mode .input-actions button {
    background-color: var(--dark-primary-blue-adjusted);
}
body.dark-mode .input-actions button:hover {
    background-color: var(--primary-blue);
}
body.dark-mode .input-actions .attach-btn {
    color: var(--dark-text-color);
}

/* Pi√®ces jointes (Ajustement des couleurs claires) */
body.dark-mode .attachment, body.dark-mode .attachment img {
    background-color: #3D4A5C;
    color: var(--dark-text-color);
    border: 1px solid #4D5A6C;
}

body.dark-mode .message-admin .attachment {
    background-color: rgba(0,0,0,0.2);
    border:1px solid rgba(255,255,255,0.2);
}

/* Preview fichiers avant envoi */
body.dark-mode .preview-item {
    background: #2D2D2D;
    border: 1px solid #444444;
    color: var(--dark-text-color);
}


/* ================= Global Styles (General Layout) ================= */
body {
    font-family: 'Arial', sans-serif;
    margin:0; padding:0;
    background-color: var(--light-bg);
    display:flex;
    min-height:100vh;
    color: var(--text-color);
    transition: background-color 0.3s, color 0.3s;
}

.sidebar {
    width: var(--sidebar-width);
    background-color: var(--dark-blue);
    color: white;
    padding: 20px 0;
    display: flex;
    flex-direction: column;
    box-shadow: 2px 0 5px rgba(0,0,0,0.1);
    position: fixed;
    top:0;
    left:0;
    height: 100vh;
    z-index:1000;
    box-sizing:border-box;
    transition: background-color 0.3s, color 0.3s;
}

.nav-menu { flex-grow:1; }
.sidebar-header { 
    text-align:center; 
    padding:0 20px 30px; 
    font-size:1.8em; 
    font-weight:bold; 
    color:white; 
    display:flex; 
    align-items:center; 
    justify-content:center; 
    transition: color 0.3s;
}

    /* Conteneur pour le logo et le texte (ASSA-AC PORTAL) */
    .header-logo-container {
        display: flex;
        align-items: center;
        padding: 0 20px;
        margin-bottom: 25px; 
    }
    
    /* Style du texte "ASSA-AC PORTAL" */
    .logo-text {
        font-size: 1.5rem;
        font-weight: 700;
        color: #0dace0;
        margin-left: 15px; 
        letter-spacing: 1px;
        transition: color 0.3s;
    }

    /* STYLE LOGO ASSA-AC (40px) */
    #assaac-logo { height: 70px; width: auto; }

.sidebar-bottom { 
    padding:10px 0; 
    border-top:1px solid rgba(255,255,255,0.1); 
}

.nav-menu a, .sidebar-bottom a { 
    display:flex; 
    align-items:center; 
    padding:15px 20px; 
    text-decoration:none; 
    color:var(--nav-text-default); 
    transition: background-color 0.2s,color 0.2s,border-left 0.2s; 
}
.nav-menu a:hover, .sidebar-bottom a:hover { 
    background-color: rgba(255,255,255,0.1); 
    color:white; 
    border-left:4px solid var(--primary-blue); 
    padding-left:16px; 
}
.nav-menu a.active { 
    background-color: var(--primary-blue); 
    color:white; 
    font-weight:bold; 
    border-left:4px solid white; 
    padding-left:16px; 
}

/* ‚úÖ Espacement ic√¥nes */
.nav-menu a i, .sidebar-bottom a i {
    margin-right: 12px;
    width: 20px;
    text-align: center;
}

/* Main Content */
.main-content { 
    flex-grow:1; 
    margin-left:var(--sidebar-width); 
    display:flex; 
    flex-direction:column; 
    height:100vh; 
}
.header { 
    background-color:var(--surface-color); 
    padding:15px 30px; 
    display:flex; 
    justify-content:flex-end; 
    align-items:center; 
    box-shadow:0 1px 4px rgba(0,0,0,0.05); 
    transition: background-color 0.3s, box-shadow 0.3s;
}
.header-actions { display:flex; align-items:center; width:100%; }
.search-bar { margin-right:auto; flex-grow:1; max-width:400px; }
.search-bar input { 
    padding:10px 15px; 
    border:1px solid var(--border-color); 
    border-radius:20px; 
    width:100%; 
    outline:none; 
    background:var(--surface-color); 
    color:var(--text-color);
    transition: background-color 0.3s, border-color 0.3s, color 0.3s;
}
.user-interaction-group { display:flex; align-items:center; }
.icon-btn { background:none; border:none; color:var(--text-color); margin-left:15px; cursor:pointer; font-size:1.1em; padding:5px; transition: color 0.2s; }
.icon-btn:hover { color:var(--primary-blue); }
.user-info { display:flex; align-items:center; margin-left:25px; cursor:pointer; border-left:1px solid var(--border-color); padding-left:25px; transition: border-left 0.3s; }
.user-avatar { width:35px; height:35px; border-radius:50%; background-color:#ccc; margin-right:10px; object-fit:cover; display:flex; align-items:center; justify-content:center; font-weight:bold; color:white; }

/* Messaging Layout */
.messaging-container { display:flex; flex-grow:1; overflow:hidden; }
.conversations-list { width:350px; flex-shrink:0; background:var(--surface-color); border-right:1px solid var(--border-color); overflow-y:auto; padding:10px 0; transition: background-color 0.3s, border-color 0.3s; }

/* MODIFICATION: Retrait de justify-content:space-between; car le bouton a √©t√© supprim√© du HTML */
.list-header { 
    padding:10px 20px 15px; 
    font-size:1.2em; 
    font-weight:bold; 
    color: var(--dark-blue); 
    display:flex;
    align-items:center; 
    transition: color 0.3s; 
}

/* .new-message-btn rules have been removed */

/* Conversation Item */
.conversation-item { display:flex; align-items:center; padding:10px 20px; border-bottom:1px solid #F0F0F0; cursor:pointer; transition: background-color 0.2s, border-color 0.3s; }
.conversation-item:hover { background-color:var(--list-hover-bg); }
.conversation-item.active { background-color:var(--list-active-bg); }
.conv-avatar { width:45px; height:45px; border-radius:50%; object-fit:cover; background-color:#ccc; flex-shrink:0; margin-right:15px; display:flex; align-items:center; justify-content:center; font-weight:bold; color:white; }
.conv-info { flex-grow:1; }
.conv-company { font-weight:bold; color: var(--dark-blue); transition: color 0.3s; }

/* Chat Area */
.chat-area { flex-grow:1; display:flex; flex-direction:column; background-color:var(--chat-background); height:calc(100vh - 70px); transition: background-color 0.3s;}
.chat-header { background:var(--surface-color); padding:15px 20px; border-bottom:1px solid var(--border-color); display:flex; align-items:center; transition: background-color 0.3s, border-color 0.3s; }
.chat-header img { width:45px; height:45px; border-radius:50%; object-fit:cover; margin-right:15px; }
.chat-header-details { flex-grow:1; }
.chat-header h2 { margin:0; font-size:1.2em; color:var(--primary-blue); transition: color 0.3s;}
.chat-header p { margin:0; font-size:0.85em; color:var(--secondary-text-color); transition: color 0.3s;}
.chat-messages { flex-grow:1; padding:20px; overflow-y:auto; display:flex; flex-direction:column; gap:15px;}

/* Bulles de message */
.message {
    max-width:70%;
    padding:10px 15px;
    border-radius:15px;
    line-height:1.4;
    position:relative;
    box-shadow:0 1px 2px rgba(0,0,0,0.1);
    transition: background-color 0.3s, color 0.3s, border-color 0.3s;
}

/* Admin √† gauche */
.message-admin {
    background: var(--primary-blue);
    color: white;
    align-self: flex-start;
    border-radius: 15px 15px 15px 5px;
}
.message-admin::after {
    content:"";
    position:absolute;
    left:-6px;
    top:10px;
    width:0;
    height:0;
    border-top:8px solid transparent;
    border-bottom:8px solid transparent;
    border-right:8px solid var(--primary-blue);
    transition: border-right-color 0.3s;
}

/* Client √† droite */
.message-client {
    background:var(--surface-color);
    color: var(--text-color);
    align-self: flex-end;
    border:1px solid var(--client-bubble-border);
    border-radius: 15px 15px 5px 15px;
}
.message-client::after {
    content:"";
    position:absolute;
    right:-6px;
    top:10px;
    width:0;
    height:0;
    /* Utilisation de la couleur de fond de la bulle pour la pointe */
    border-top:8px solid transparent;
    border-bottom:8px solid transparent;
    border-left:8px solid var(--surface-color); 
    transition: border-left-color 0.3s;
}

/* Pi√®ces jointes et images */
.attachment, .attachment img {
    display:flex;
    align-items:center;
    background-color:#e0f2ff;
    color:var(--dark-blue);
    padding:8px 10px;
    border-radius:8px;
    margin-top:5px;
    cursor:pointer;
    font-size:0.8em;
    border:1px solid #cce0ff;
    max-width: 200px;
    transition: background-color 0.3s, color 0.3s, border-color 0.3s;
}
.attachment img {
    max-width: 100%;
    border-radius: 6px;
}
.message-admin .attachment {
    background-color: rgba(255,255,255,0.2);
    color:white;
    border:1px solid rgba(255,255,255,0.4);
}

/* Chat Input */
.chat-input-area { background:var(--surface-color); padding:15px 20px; border-top:1px solid var(--border-color); display:flex; align-items:center; transition: background-color 0.3s, border-top-color 0.3s; }
.chat-input-area textarea { flex-grow:1; padding:10px; border:1px solid var(--border-color); border-radius:8px; resize:none; margin-right:10px; font-family:inherit; transition: background-color 0.3s, border-color 0.3s, color 0.3s; }
.input-actions { display:flex; align-items:center; }
.input-actions button { background-color: var(--primary-blue); color:white; border:none; padding:10px 15px; border-radius:8px; cursor:pointer; margin-left:5px; transition:background-color 0.2s;}
.input-actions button:hover { background-color: var(--dark-blue); }
.input-actions .attach-btn { background:none; color:var(--text-color); font-size:1.2em; margin-right:10px; border:none; cursor:pointer; transition: color 0.3s; }

/* Messages temporaires / envoi / √©chec */
.message-temp {
    opacity: 0.6;
    filter: grayscale(30%);
    pointer-events: none;
}
.message-sending {
    opacity: 0.8;
    animation: pulse 1.2s infinite;
}
.message-failed {
    opacity: 0.8;
    border: 1px solid var(--alert-red);
}
@keyframes pulse {
    0% { transform: scale(1); opacity: 0.8; }
    50% { transform: scale(1.02); opacity: 0.5; }
    100% { transform: scale(1); opacity: 0.8; }
}

/* Preview fichiers avant envoi */
.preview-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px 20px;
    border-top: 1px solid var(--border-color);
    background: var(--surface-color);
    transition: background-color 0.3s, border-color 0.3s;
}
.preview-item {
    position: relative;
    background: #f1f5ff;
    border: 1px solid #c9d7ff;
    padding: 8px 12px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 0.85em;
    color: var(--dark-blue);
    max-width: 250px;
    transition: background-color 0.3s, border-color 0.3s, color 0.3s;
}
.preview-item i {
    font-size: 1.2em;
}
.preview-remove {
    position: absolute;
    top: -6px;
    right: -6px;
    background: var(--alert-red);
    color: #fff;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    font-size: 0.75em;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
}